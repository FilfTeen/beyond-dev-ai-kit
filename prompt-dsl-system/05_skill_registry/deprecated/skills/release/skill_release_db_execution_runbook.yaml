# DEPRECATED: replaced by skill_hongzhi_universal_ops
# Suggested mode: release
# Mapping hints: Use mode=release; put refs_hint=skill_release_db_execution_runbook in objective/constraints; preserve legacy acceptance checks.
# Original name: skill_release_db_execution_runbook
name: "skill_release_db_execution_runbook"
description: "Generate a minimal operator runbook for direct SQL execution windows (Navicat/disql/DBeaver) with Fresh/Incremental scenarios, fail-fast stop points, and rollback actions. Use for Oracle/DM8 release execution guidance with schema-noise reduction strategies."
version: "1.0.0"
domain: "release"
tags:
  - "release"
  - "db"
  - "sql"
  - "runbook"
  - "oracle"
  - "dm8"
  - "execution"
parameters:
  - name: "module_path"
    type: "string"
    required: true
    description: "Repository-relative or absolute scope for runbook outputs."
  - name: "objective"
    type: "string"
    required: true
    description: "Concrete runbook objective and environment constraints."
  - name: "target_db"
    type: "string"
    required: true
    description: "Target database type: oracle|dm8."
  - name: "execution_tool"
    type: "string"
    required: true
    description: "Primary execution tool: navicat|disql|dbeaver|generic."
  - name: "schema_strategy"
    type: "string"
    required: true
    description: "Schema handling strategy: auto|login-default|embed-header|run-entry."
  - name: "context_id"
    type: "string"
    required: false
    description: "Pipeline-run context identifier for cross-step linkage."
  - name: "trace_id"
    type: "string"
    required: false
    description: "Unique trace id for the run (recommended)."
  - name: "input_artifact_refs"
    type: "array"
    required: false
    items: string
    description: "Artifact ids from previous steps (e.g., [\"A1\", \"A2\"])."
prompt_template: |
  You are the enterprise delivery assistant.
  Skill: skill_release_db_execution_runbook
  Goal: Generate a minimal and directly executable DB release runbook.

  Input:
  - module_path: {{module_path}}
  - objective: {{objective}}
  - target_db: {{target_db}}
  - execution_tool: {{execution_tool}}
  - schema_strategy: {{schema_strategy}}
  - context_id: {{context_id}}
  - trace_id: {{trace_id}}
  - input_artifact_refs: {{input_artifact_refs}}

  Execution focus:
  - Emphasize direct execution experience (like Navicat window workflow).
  - For Oracle: default to Navicat-style no-schema-noise execution guidance.
  - For DM8: reduce schema friction via three alternatives: login-default schema, embedded header, unified run entry.

  Artifact handoff requirements:
  - Number artifacts as A1, A2, A3...
  - Must include:
    - A1_release_runbook.md (Fresh + Incremental scenarios).
    - A2_failfast_and_rollback.md (stop-loss and rollback points).
    - A3_tool_specific_commands.md (navicat/disql/dbeaver shortest command table).

  Upstream artifact reference rule:
  - If input_artifact_refs is provided, read and cite those artifact ids before generating new artifacts.

  Return ONLY the unified output structure:
  - summary
  - artifacts[]
  - risks[]
  - next_actions[]
output_contract:
  summary: "Concise execution runbook outcome with schema strategy and operator assumptions."
  artifacts:
    - id: "A1"
      name: "A1_release_runbook"
      description: "Fresh/Incremental execution runbook for the target DB."
    - id: "A2"
      name: "A2_failfast_and_rollback"
      description: "Fail-fast stop points and rollback decision/action mapping."
    - id: "A3"
      name: "A3_tool_specific_commands"
      description: "Tool-specific shortest command reference for navicat/disql/dbeaver."
  risks:
    - "Known execution-window and rollback risks under direct operation mode."
  next_actions:
    - "Ordered follow-ups for dry run and release-window readiness."
examples:
  - input:
      module_path: "<MODULE_PATH>"
      objective: |
        inputs: "batch sql + merged sql + release constraints"
        constraints: "operator should run with minimal manual schema typing"
        acceptance: "A1/A2/A3 runbook artifacts"
        forbidden: "no credential disclosure"
      target_db: "dm8"
      execution_tool: "disql"
      schema_strategy: "run-entry"
      context_id: "CTX-RUNBOOK"
      trace_id: "TRACE-RUNBOOK"
      input_artifact_refs:
        - "A1"
        - "A2"
    output:
      summary: "Execution runbook generated with DM8 schema-noise reduction options."
      artifacts:
        - id: "A1"
          name: "A1_release_runbook"
          description: "Fresh and Incremental operator runbook."
        - id: "A2"
          name: "A2_failfast_and_rollback"
          description: "Stop points and rollback path matrix."
        - id: "A3"
          name: "A3_tool_specific_commands"
          description: "Minimal command table for Navicat/disql/dbeaver."
      risks:
        - "Schema strategy mismatch can cause object-resolution failures."
      next_actions:
        - "Dry-run runbook in staging with the target execution tool."
