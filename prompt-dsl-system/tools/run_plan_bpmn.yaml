run:
  pipeline: "prompt-dsl-system/04_ai_pipeline_orchestration/pipeline_bpmn_state_audit_testgen.md"
  context_id: "ctx-3c19cd711536"
  trace_id: "trace-81798aa83efc460bb13f5fa6efdf2f99"
  generated_at: "2026-02-09T10:41:48+00:00"
  profile:
    path: "prompt-dsl-system/company_profile.yaml"
    applied: true
    injected_defaults:
      execution_tool: "disql"
      require_precheck_gate: true
      schema_strategy: "login-default"
steps:
  - step: 1
    skill: "skill_hongzhi_universal_ops"
    skill_path: "prompt-dsl-system/05_skill_registry/skills/universal/skill_hongzhi_universal_ops.yaml"
    parameters:
      context_id: "ctx-3c19cd711536"
      trace_id: "trace-81798aa83efc460bb13f5fa6efdf2f99"
      input_artifact_refs: []
      acceptance:
        - "A1 impact tree"
        - "A2 route tradeoff"
      boundary_policy: "allowed_module_root: \"{{allowed_module_root}}\"\nforbidden_paths: [\"/sys\", \"/error\", \"/util\", \"/vote\"]\nmax_change_scope: \"minimal\""
      constraints:
        - "scan-only when boundary missing"
      decision_policy: "{dependency_strategy_order: [\"compat\", \"self-contained\", \"minimal-invasive\"], choose_best_route_with_tradeoff: true}"
      execution_tool: "disql"
      fact_policy: "{require_scan_before_change: true, unknown_requires_user: true}"
      forbidden:
        - "禁止改 /sys,/error,/util,/vote"
        - "禁止臆测命名/字段/逻辑"
      mode: "governance"
      module_path: "{{allowed_module_root}}"
      objective: "{{objective}}；refs_hint: bpmn parse；先扫描并输出影响树与路线A/B。"
      require_precheck_gate: true
      schema_strategy: "login-default"
      self_monitor_policy: "{loop_detection: true, auto_rollback_on_loop: true}"
      sql_policy: "{prefer_portable_sql: true, dual_sql_when_needed: [\"oracle\", \"mysql\"]}"
    expects:
      artifacts:
        - "A1"
        - "A2"
      notes: "Artifacts must be numbered A1/A2/... per SKILL_SPEC."
    handoff: "来自下一步引用：A1, A2（来自上一步 artifacts）"
  - step: 2
    skill: "skill_hongzhi_universal_ops"
    skill_path: "prompt-dsl-system/05_skill_registry/skills/universal/skill_hongzhi_universal_ops.yaml"
    parameters:
      context_id: "ctx-3c19cd711536"
      trace_id: "trace-81798aa83efc460bb13f5fa6efdf2f99"
      input_artifact_refs:
        - "A1"
        - "A2"
      acceptance:
        - "A* mapping table"
      boundary_policy: "allowed_module_root: \"{{allowed_module_root}}\"\nforbidden_paths: [\"/sys\", \"/error\", \"/util\", \"/vote\"]\nmax_change_scope: \"minimal\""
      constraints:
        - "facts from bpmn and implementation only"
      decision_policy: "{dependency_strategy_order: [\"compat\", \"self-contained\", \"minimal-invasive\"], choose_best_route_with_tradeoff: true}"
      execution_tool: "disql"
      fact_policy: "{require_scan_before_change: true, unknown_requires_user: true}"
      forbidden:
        - "禁止改 /sys,/error,/util,/vote"
        - "禁止臆测命名/字段/逻辑"
      mode: "process"
      module_path: "{{allowed_module_root}}"
      objective: "{{objective}}；refs_hint: state mapping audit；输出状态映射与异常清单。"
      require_precheck_gate: true
      schema_strategy: "login-default"
      self_monitor_policy: "{loop_detection: true, auto_rollback_on_loop: true}"
      sql_policy: "{prefer_portable_sql: true, dual_sql_when_needed: [\"oracle\", \"mysql\"]}"
    expects:
      artifacts:
        - "A1"
        - "A2"
      notes: "Artifacts must be numbered A1/A2/... per SKILL_SPEC."
    handoff: "来自下一步引用：A2（来自上一步 artifacts）"
  - step: 3
    skill: "skill_hongzhi_universal_ops"
    skill_path: "prompt-dsl-system/05_skill_registry/skills/universal/skill_hongzhi_universal_ops.yaml"
    parameters:
      context_id: "ctx-3c19cd711536"
      trace_id: "trace-81798aa83efc460bb13f5fa6efdf2f99"
      input_artifact_refs:
        - "A2"
      acceptance:
        - "A* test cases"
      boundary_policy: "allowed_module_root: \"{{allowed_module_root}}\"\nforbidden_paths: [\"/sys\", \"/error\", \"/util\", \"/vote\"]\nmax_change_scope: \"minimal\""
      constraints:
        - "test cases must map to audited states"
      decision_policy: "{dependency_strategy_order: [\"compat\", \"self-contained\", \"minimal-invasive\"], choose_best_route_with_tradeoff: true}"
      execution_tool: "disql"
      fact_policy: "{require_scan_before_change: true, unknown_requires_user: true}"
      forbidden:
        - "禁止改 /sys,/error,/util,/vote"
        - "禁止臆测命名/字段/逻辑"
      mode: "process"
      module_path: "{{allowed_module_root}}"
      objective: "{{objective}}；refs_hint: process test generation；生成主路径/异常/边界测试。"
      require_precheck_gate: true
      schema_strategy: "login-default"
      self_monitor_policy: "{loop_detection: true, auto_rollback_on_loop: true}"
      sql_policy: "{prefer_portable_sql: true, dual_sql_when_needed: [\"oracle\", \"mysql\"]}"
    expects:
      artifacts:
        - "A1"
        - "A2"
      notes: "Artifacts must be numbered A1/A2/... per SKILL_SPEC."
    handoff: "来自下一步引用：A3（来自上一步 artifacts）"
  - step: 4
    skill: "skill_hongzhi_universal_ops"
    skill_path: "prompt-dsl-system/05_skill_registry/skills/universal/skill_hongzhi_universal_ops.yaml"
    parameters:
      context_id: "ctx-3c19cd711536"
      trace_id: "trace-81798aa83efc460bb13f5fa6efdf2f99"
      input_artifact_refs:
        - "A3"
      acceptance:
        - "A* change ledger"
        - "A* rollback plan"
        - "A* cleanup report"
      boundary_policy: "allowed_module_root: \"{{allowed_module_root}}\"\nforbidden_paths: [\"/sys\", \"/error\", \"/util\", \"/vote\"]\nmax_change_scope: \"minimal\""
      constraints:
        - "closure required"
      decision_policy: "{dependency_strategy_order: [\"compat\", \"self-contained\", \"minimal-invasive\"], choose_best_route_with_tradeoff: true}"
      execution_tool: "disql"
      fact_policy: "{require_scan_before_change: true, unknown_requires_user: true}"
      forbidden:
        - "禁止改 /sys,/error,/util,/vote"
        - "禁止臆测命名/字段/逻辑"
      mode: "docs"
      module_path: "{{allowed_module_root}}"
      objective: "{{objective}}；输出 API/DB 文档补充、变更台账、回滚说明、清理报告。"
      require_precheck_gate: true
      schema_strategy: "login-default"
      self_monitor_policy: "{loop_detection: true, auto_rollback_on_loop: true}"
      sql_policy: "{prefer_portable_sql: true, dual_sql_when_needed: [\"oracle\", \"mysql\"]}"
    expects:
      artifacts:
        - "A1"
        - "A2"
      notes: "Artifacts must be numbered A1/A2/... per SKILL_SPEC."
    handoff: "Final step."
