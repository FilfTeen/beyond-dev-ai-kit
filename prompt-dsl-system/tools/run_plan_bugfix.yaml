run:
  pipeline: "prompt-dsl-system/04_ai_pipeline_orchestration/pipeline_bugfix_min_scope_with_tree.md"
  context_id: "ctx-1ac6df3050d0"
  trace_id: "trace-a9befdbdddb04a1a84f47d2891db8db7"
  generated_at: "2026-02-09T10:41:48+00:00"
  profile:
    path: "prompt-dsl-system/company_profile.yaml"
    applied: true
    injected_defaults:
      execution_tool: "disql"
      require_precheck_gate: true
      schema_strategy: "login-default"
steps:
  - step: 1
    skill: "skill_hongzhi_universal_ops"
    skill_path: "prompt-dsl-system/05_skill_registry/skills/universal/skill_hongzhi_universal_ops.yaml"
    parameters:
      context_id: "ctx-1ac6df3050d0"
      trace_id: "trace-a9befdbdddb04a1a84f47d2891db8db7"
      input_artifact_refs: []
      acceptance:
        - "A* impact tree"
        - "A* route comparison"
      boundary_policy: "allowed_module_root: \"{{allowed_module_root}}\"\nforbidden_paths: [\"/sys\", \"/error\", \"/util\", \"/vote\"]\nmax_change_scope: \"minimal\""
      constraints:
        - "scan-only"
        - "decision order: compat > self-contained > minimal-invasive"
      decision_policy: "{dependency_strategy_order: [\"compat\", \"self-contained\", \"minimal-invasive\"], choose_best_route_with_tradeoff: true}"
      execution_tool: "disql"
      fact_policy: "{require_scan_before_change: true, unknown_requires_user: true}"
      forbidden:
        - "禁止改 /sys,/error,/util,/vote"
        - "禁止臆测命名/字段/逻辑"
      mode: "governance"
      module_path: "{{allowed_module_root}}"
      objective: "{{objective}}；先扫描，输出影响树和路线A/B（compat/self-contained/minimal-invasive）。"
      require_precheck_gate: true
      schema_strategy: "login-default"
      self_monitor_policy: "{loop_detection: true, auto_rollback_on_loop: true}"
      sql_policy: "{prefer_portable_sql: true, dual_sql_when_needed: [\"oracle\", \"mysql\"]}"
    expects:
      artifacts:
        - "A1"
        - "A2"
      notes: "Artifacts must be numbered A1/A2/... per SKILL_SPEC."
    handoff: "来自下一步引用：A1, A2（来自上一步 artifacts）"
  - step: 2
    skill: "skill_hongzhi_universal_ops"
    skill_path: "prompt-dsl-system/05_skill_registry/skills/universal/skill_hongzhi_universal_ops.yaml"
    parameters:
      context_id: "ctx-1ac6df3050d0"
      trace_id: "trace-a9befdbdddb04a1a84f47d2891db8db7"
      input_artifact_refs:
        - "A1"
        - "A2"
      acceptance:
        - "A* patch ledger"
        - "A* rollback trigger"
      boundary_policy: "allowed_module_root: \"{{allowed_module_root}}\"\nforbidden_paths: [\"/sys\", \"/error\", \"/util\", \"/vote\"]\nmax_change_scope: \"minimal\""
      constraints:
        - "only inside allowed_module_root"
        - "loop signal => rollback first"
      decision_policy: "{dependency_strategy_order: [\"compat\", \"self-contained\", \"minimal-invasive\"], choose_best_route_with_tradeoff: true}"
      execution_tool: "disql"
      fact_policy: "{require_scan_before_change: true, unknown_requires_user: true}"
      forbidden:
        - "禁止改 /sys,/error,/util,/vote"
        - "禁止臆测命名/字段/逻辑"
      mode: "code"
      module_path: "{{allowed_module_root}}"
      objective: "{{objective}}；按 Step1 选择的最优路线执行最小侵入补丁。"
      require_precheck_gate: true
      schema_strategy: "login-default"
      self_monitor_policy: "{loop_detection: true, auto_rollback_on_loop: true}"
      sql_policy: "{prefer_portable_sql: true, dual_sql_when_needed: [\"oracle\", \"mysql\"]}"
    expects:
      artifacts:
        - "A1"
        - "A2"
      notes: "Artifacts must be numbered A1/A2/... per SKILL_SPEC."
    handoff: "来自下一步引用：A2（来自上一步 artifacts）"
  - step: 3
    skill: "skill_hongzhi_universal_ops"
    skill_path: "prompt-dsl-system/05_skill_registry/skills/universal/skill_hongzhi_universal_ops.yaml"
    parameters:
      context_id: "ctx-1ac6df3050d0"
      trace_id: "trace-a9befdbdddb04a1a84f47d2891db8db7"
      input_artifact_refs:
        - "A2"
      acceptance:
        - "A* smoke checklist"
        - "A* rollback plan"
      boundary_policy: "allowed_module_root: \"{{allowed_module_root}}\"\nforbidden_paths: [\"/sys\", \"/error\", \"/util\", \"/vote\"]\nmax_change_scope: \"minimal\""
      constraints:
        - "release safety first"
      decision_policy: "{dependency_strategy_order: [\"compat\", \"self-contained\", \"minimal-invasive\"], choose_best_route_with_tradeoff: true}"
      execution_tool: "disql"
      fact_policy: "{require_scan_before_change: true, unknown_requires_user: true}"
      forbidden:
        - "禁止改 /sys,/error,/util,/vote"
        - "禁止臆测命名/字段/逻辑"
      mode: "release"
      module_path: "{{allowed_module_root}}"
      objective: "{{objective}}；生成 smoke checklist 与 fail-fast rollback plan。"
      require_precheck_gate: true
      schema_strategy: "login-default"
      self_monitor_policy: "{loop_detection: true, auto_rollback_on_loop: true}"
      sql_policy: "{prefer_portable_sql: true, dual_sql_when_needed: [\"oracle\", \"mysql\"]}"
    expects:
      artifacts:
        - "A1"
        - "A2"
      notes: "Artifacts must be numbered A1/A2/... per SKILL_SPEC."
    handoff: "来自下一步引用：A3（来自上一步 artifacts）"
  - step: 4
    skill: "skill_hongzhi_universal_ops"
    skill_path: "prompt-dsl-system/05_skill_registry/skills/universal/skill_hongzhi_universal_ops.yaml"
    parameters:
      context_id: "ctx-1ac6df3050d0"
      trace_id: "trace-a9befdbdddb04a1a84f47d2891db8db7"
      input_artifact_refs:
        - "A3"
      acceptance:
        - "A* change ledger"
        - "A* cleanup report"
      boundary_policy: "allowed_module_root: \"{{allowed_module_root}}\"\nforbidden_paths: [\"/sys\", \"/error\", \"/util\", \"/vote\"]\nmax_change_scope: \"minimal\""
      constraints:
        - "closure mandatory"
      decision_policy: "{dependency_strategy_order: [\"compat\", \"self-contained\", \"minimal-invasive\"], choose_best_route_with_tradeoff: true}"
      execution_tool: "disql"
      fact_policy: "{require_scan_before_change: true, unknown_requires_user: true}"
      forbidden:
        - "禁止改 /sys,/error,/util,/vote"
        - "禁止臆测命名/字段/逻辑"
      mode: "docs"
      module_path: "{{allowed_module_root}}"
      objective: "{{objective}}；更新模块 README 与收尾文档（change ledger/cleanup）。"
      require_precheck_gate: true
      schema_strategy: "login-default"
      self_monitor_policy: "{loop_detection: true, auto_rollback_on_loop: true}"
      sql_policy: "{prefer_portable_sql: true, dual_sql_when_needed: [\"oracle\", \"mysql\"]}"
    expects:
      artifacts:
        - "A1"
        - "A2"
      notes: "Artifacts must be numbered A1/A2/... per SKILL_SPEC."
    handoff: "Final step."
